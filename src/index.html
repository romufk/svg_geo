<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG_GEO Viewer - D√©monstration</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
    }

    .demo-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .demo-header {
      background: white;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .demo-header h1 {
      color: #333;
      margin-bottom: 8px;
    }

    .demo-header p {
      color: #666;
      font-size: 0.95rem;
    }

    .demo-controls {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .demo-controls label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #555;
    }

    .demo-controls input[type="file"] {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .demo-controls button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.2s;
    }

    .demo-controls button:hover {
      background: #0056b3;
    }

    .viewer-wrapper {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
      height: 600px;
    }

    #viewer {
      height: 100%;
      overflow: hidden; /* Pas d'ascenseur sur le viewer */
    }

    .demo-info {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .demo-info h2 {
      color: #333;
      margin-bottom: 12px;
      font-size: 1.25rem;
    }

    .demo-info pre {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.85rem;
    }

    .example-link {
      display: inline-block;
      margin-top: 12px;
      padding: 8px 16px;
      background: #28a745;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      font-size: 0.9rem;
      transition: background 0.2s;
    }

    .example-link:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="demo-header">
      <h1>üó∫Ô∏è SVG_GEO Viewer - D√©monstration</h1>
      <p>Visualiseur interactif pour fichiers SVG enrichis selon la norme SVG_GEO v0.1</p>
    </div>

    <div class="demo-controls">
      <label for="file-input">Charger un fichier SVG_GEO :</label>
      <input type="file" id="file-input" accept=".svg">
      <button onclick="loadExampleSVG()">Charger l'exemple</button>
      <button onclick="exportData()">Exporter les donn√©es</button>
    </div>

    <div class="viewer-wrapper">
      <div id="viewer"></div>
    </div>

    <div class="demo-info">
      <h2>üìã Fonctionnalit√©s</h2>
      <ul style="margin-left: 20px; color: #555; line-height: 1.8;">
        <li><strong>Survol</strong> : Passez la souris sur un √©l√©ment pour voir ses informations de base</li>
        <li><strong>Clic</strong> : Cliquez sur un √©l√©ment pour afficher toutes ses donn√©es dans une modal</li>
        <li><strong>Zoom</strong> : Utilisez la molette de la souris pour zoomer/d√©zoomer</li>
        <li><strong>D√©placement</strong> : Clic gauche maintenu pour d√©placer le plan</li>
        <li><strong>Menu contextuel</strong> : Clic droit pour acc√©der au menu (zoom, plein √©cran, couches, export, etc.)</li>
        <li><strong>Plein √©cran</strong> : Touche √âchap pour sortir du mode plein √©cran</li>
        <li><strong>Couches</strong> : Utilisez les contr√¥les en bas ou le menu contextuel pour g√©rer les couches</li>
        <li><strong>Export</strong> : T√©l√©chargez en SVG ou copiez dans le presse-papier</li>
        <li><strong>√âv√©nements</strong> : √âcoutez les √©v√©nements (zoom, pan, clic, etc.) via l'API</li>
      </ul>
      
      <h2 style="margin-top: 24px;">üîß API JavaScript</h2>
      <pre>
        
// Cr√©er une instance du viewer avec toutes les options
const viewer = new SVGGeoViewer('viewer', {
  showLayerControl: true,
  showHoverInfo: true,
  enableModal: true,
  enableZoom: true,
  enablePan: true,
  enableContextMenu: true,
  locale: 'fr', // ou 'en'
  contextMenuItems: [
    { label: 'Mon action', icon: '‚ö°' }
  ]
});

// Charger un fichier SVG
await viewer.loadSVG('mon-plan.svg');

// Zoom et navigation
viewer.setZoom(1.5); // Zoom 150%
viewer.resetView(); // R√©initialiser

// Plein √©cran
viewer.enterFullscreen();
viewer.exitFullscreen();
viewer.toggleFullscreen();

// Contr√¥ler les couches
viewer.toggleLayer('buildings', false); // Masquer
viewer.setLayerOpacity('parcels', 0.5); // Semi-transparent

// Export
viewer.downloadSVG(); // T√©l√©charger
await viewer.copyToClipboard(); // Copier

// Syst√®me d'√©v√©nements
viewer.on('zoom', (data) => {
  console.log('Nouveau zoom:', data.zoom);
});

viewer.on('click', (data) => {
  console.log('√âl√©ment cliqu√©:', data.element);
});

viewer.on('contextMenuItem', (data) => {
  console.log('Item menu:', data.item);
});

// Traduction
viewer.setLocale('en'); // Anglais
viewer.setTranslations({ 'Building': '√âdifice' });</pre>
    </div>
  </div>

  <script src="svg-geo-viewer.js"></script>
  <script>
    let viewer;

    // Initialiser le viewer
    document.addEventListener('DOMContentLoaded', () => {
      viewer = new SVGGeoViewer('viewer', {
        showLayerControl: true,
        showHoverInfo: true,
        enableModal: true,
        enableZoom: true,
        enablePan: true,
        enableContextMenu: true,
        contextMenuItems: [
          { label: 'Action personnalis√©e 1', icon: '‚ö°' },
          { label: 'Action personnalis√©e 2', icon: 'üé®' }
        ]
      });

      // √âcouter les √©v√©nements
      viewer.on('loaded', (data) => {
        console.log('SVG charg√©:', data);
      });

      viewer.on('zoom', (data) => {
        console.log('Zoom:', data.zoom);
      });

      viewer.on('pan', (data) => {
        console.log('Pan:', data.x, data.y);
      });

      viewer.on('fullscreen', (data) => {
        console.log('Mode plein √©cran:', data.fullscreen);
      });

      viewer.on('contextMenuItem', (data) => {
        console.log('Item personnalis√© cliqu√©:', data.item);
        alert(`Vous avez cliqu√© sur: ${data.item.label}`);
      });
    });

    // Gestion du fichier upload√©
    document.getElementById('file-input').addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      try {
        const text = await file.text();
        await viewer.loadSVGFromString(text);
        console.log('SVG charg√© avec succ√®s');
      } catch (error) {
        alert('Erreur lors du chargement du fichier : ' + error.message);
        console.error(error);
      }
    });

    // Charger l'exemple
    async function loadExampleSVG() {
      const exampleSVG = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
     version="1.1"
     viewBox="0 0 800 600"
     data-svg-geo-version="0.2">

  <metadata id="SVG_GEO_DOCUMENT">
  {
    "document": {
      "schemaVersion": "0.2",
      "vocabularyVersion": "0.1",
      "created": "2025-11-27",
      "lastModified": "2025-11-27",
      "author": "D√©mo SVG_GEO",
      "lang": "fr",
      "defaultUnit": "m",
      "coordinateReferenceSystem": "EPSG:2154"
    },
    "project": {
      "projectName": "Plan exemple - Ancienne Mairie",
      "projectId": "DEMO-001",
      "source": "Demo",
      "domain": "Heritage Architecture"
    }
  }
  </metadata>

  <metadata id="SVG_GEO_DATA">
  {
    "B001": {
      "class": "Building",
      "attributes": {
        "name": "Ancienne Mairie",
        "yearOfConstruction": 1850,
        "heritageStatus": "Protected",
        "address": "15 Rue des √âcoles, 75000 Paris"
      }
    },
    "P001": {
      "class": "Parcel",
      "attributes": {
        "cadastralRef": "AB-123-456",
        "area": "450m2",
        "owner": "Ville de Lens"
      }
    },
    "layers": {
      "background": {
        "label": { "fr": "Fond de plan", "en": "Background" },
        "defaultVisible": true,
        "defaultOpacity": 1.0,
        "order": 0
      },
      "parcels": {
        "label": { "fr": "Parcelles", "en": "Parcels" },
        "defaultVisible": true,
        "defaultOpacity": 0.5,
        "order": 10
      },
      "buildings": {
        "label": { "fr": "B√¢timents", "en": "Buildings" },
        "defaultVisible": true,
        "defaultOpacity": 1.0,
        "order": 20
      },
      "networks": {
        "label": { "fr": "R√©seaux", "en": "Networks" },
        "defaultVisible": false,
        "defaultOpacity": 1.0,
        "order": 30
      }
    }
  }
  </metadata>

  <!-- Fond de plan -->
  <rect x="0" y="0" width="800" height="600" fill="#f0f0f0" data-layer="background"/>
  <line x1="0" y1="300" x2="800" y2="300" stroke="#ddd" stroke-width="1" data-layer="background"/>
  <line x1="400" y1="0" x2="400" y2="600" stroke="#ddd" stroke-width="1" data-layer="background"/>

  <!-- Parcelle -->
  <path d="M 100 150 L 500 150 L 500 450 L 100 450 Z"
        fill="#e8f4e8"
        stroke="#4a8c4a"
        stroke-width="2"
        data-class="Parcel"
        data-ref="P001"
        data-layer="parcels"
        data-props='{"cadastralRef":"AB-123-456","area":"450m2"}' />

  <!-- B√¢timent principal -->
  <g id="building_01"
     data-class="Building"
     data-ref="B001"
     data-level="LOD2"
     data-layer="buildings"
     data-props='{"source":"Demo2025"}'>

    <!-- Mur nord -->
    <path id="wall_north"
          d="M 150 200 L 450 200 L 450 250 L 150 250 Z"
          fill="#c0c0c0"
          stroke="#666"
          stroke-width="2"
          data-class="WallSurface"
          data-ref="B001-W01"
          data-layer="buildings"
          data-props='{"material":"Stone","height":"3.4m","thickness":"45cm","ifcType":"IfcWall","condition":"Good","conditionDate":"2025-11-27"}' />

    <!-- Mur sud -->
    <path id="wall_south"
          d="M 150 350 L 450 350 L 450 400 L 150 400 Z"
          fill="#b8b8b8"
          stroke="#666"
          stroke-width="2"
          data-class="WallSurface"
          data-ref="B001-W02"
          data-layer="buildings"
          data-props='{"material":"Stone","height":"3.4m","thickness":"45cm","ifcType":"IfcWall","condition":"Moderate","conditionDate":"2025-11-27"}' />

    <!-- Mur est -->
    <path id="wall_east"
          d="M 450 250 L 450 350 L 400 350 L 400 250 Z"
          fill="#a8a8a8"
          stroke="#666"
          stroke-width="2"
          data-class="WallSurface"
          data-ref="B001-W03"
          data-layer="buildings"
          data-props='{"material":"Brick","height":"3.4m","thickness":"30cm","ifcType":"IfcWall","condition":"Good"}' />

    <!-- Mur ouest -->
    <path id="wall_west"
          d="M 150 250 L 200 250 L 200 350 L 150 350 Z"
          fill="#a8a8a8"
          stroke="#666"
          stroke-width="2"
          data-class="WallSurface"
          data-ref="B001-W04"
          data-layer="buildings"
          data-props='{"material":"Brick","height":"3.4m","thickness":"30cm","ifcType":"IfcWall","condition":"Poor"}' />

    <!-- Fen√™tre 1 -->
    <rect id="window_01"
          x="220" y="270" width="50" height="60"
          fill="#88ccff"
          stroke="#444"
          stroke-width="2"
          data-class="Window"
          data-ref="B001-WIN01"
          data-layer="buildings"
          data-props='{"frameMaterial":"Wood","glassType":"Single","ifcType":"IfcWindow","condition":"Moderate","yearInstalled":1850}' />

    <!-- Fen√™tre 2 -->
    <rect id="window_02"
          x="330" y="270" width="50" height="60"
          fill="#88ccff"
          stroke="#444"
          stroke-width="2"
          data-class="Window"
          data-ref="B001-WIN02"
          data-layer="buildings"
          data-props='{"frameMaterial":"PVC","glassType":"Double","ifcType":"IfcWindow","condition":"Good","yearInstalled":2020}' />

    <!-- Porte -->
    <rect id="door_01"
          x="280" y="355" width="40" height="45"
          fill="#8b4513"
          stroke="#444"
          stroke-width="2"
          data-class="Door"
          data-ref="B001-DOOR01"
          data-layer="buildings"
          data-props='{"frameMaterial":"Oak","doorType":"Main entrance","ifcType":"IfcDoor","condition":"Good","yearInstalled":1850}' />

    <!-- Toiture -->
    <path id="roof_01"
          d="M 130 200 L 300 150 L 470 200 Z"
          fill="#d2691e"
          stroke="#8b4513"
          stroke-width="2"
          data-class="RoofSurface"
          data-ref="B001-R01"
          data-layer="buildings"
          data-props='{"material":"Tile","slope":"35deg","condition":"Moderate","yearRestored":2010}' />
  </g>

  <!-- R√©seau √©lectrique (cach√© par d√©faut) -->
  <line x1="100" y1="150" x2="300" y2="300"
        stroke="orange"
        stroke-width="3"
        data-class="Cable"
        data-ref="NET-001"
        data-layer="networks"
        data-props='{"type":"Electrical","voltage":"220V","condition":"Good"}' />

  <!-- Texte -->
  <text x="300" y="480" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">
    Ancienne Mairie
  </text>
</svg>`;

      try {
        await viewer.loadSVGFromString(exampleSVG);
        console.log('Exemple charg√© avec succ√®s');
      } catch (error) {
        alert('Erreur lors du chargement de l\'exemple : ' + error.message);
        console.error(error);
      }
    }

    // Exporter les donn√©es
    function exportData() {
      if (!viewer) {
        alert('Aucun SVG charg√©');
        return;
      }

      const data = {
        documentMetadata: viewer.getDocumentMetadata(),
        globalData: viewer.getGlobalData(),
        buildings: viewer.getElementsByClass('Building'),
        windows: viewer.getElementsByClass('Window'),
        doors: viewer.getElementsByClass('Door'),
        walls: viewer.getElementsByClass('WallSurface')
      };

      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'svg-geo-export.json';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
